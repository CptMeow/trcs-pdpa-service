import{m as X}from"./VSelect-51189d3d.js";import{f as Y}from"./forwardRefs-8f7055de.js";import{m as Z,u as ee}from"./filter-00d6d293.js";import{m as le}from"./transition-482c18b0.js";import{b as ae}from"./VInput-354f6456.js";import{u as te,V as ne,a as L}from"./VList-f23cbc26.js";import{au as ue,aB as oe,aQ as se,k as V,aE as R,B as k,aH as re,z as N,ae as U,aA as ie,p as n,F as B,$ as A,a$ as ce,R as ve}from"./main-51fa4cdd.js";import{m as de,f as fe,V as me}from"./VTextField-04866304.js";import{V as pe}from"./VMenu-c40ddae7.js";import{V as Ve}from"./VCheckboxBtn-af15d0af.js";import{V as he}from"./VChip-d98b0377.js";function ye(e,i,a){if(i==null)return e;if(Array.isArray(i))throw new Error("Multiple matches is not implemented");return typeof i=="number"&&~i?n(B,null,[n("span",{class:"v-autocomplete__unmask"},[e.substr(0,i)]),n("span",{class:"v-autocomplete__mask"},[e.substr(i,a)]),n("span",{class:"v-autocomplete__unmask"},[e.substr(i+a)])]):e}const Te=ue()({name:"VAutocomplete",props:{search:String,...Z({filterKeys:["title"]}),...X(),...oe(de({modelValue:null}),["validationValue","dirty","appendInnerIcon"]),...le({transition:!1})},emits:{"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,i){let{slots:a}=i;const{t:O}=se(),I=V(),f=V(!1),d=V(!0),M=V(),P=R(e,"menu"),o=k({get:()=>P.value,set:l=>{var t;P.value&&!l&&((t=M.value)!=null&&t.Î¨openChildren)||(P.value=l)}}),{items:x,transformIn:$,transformOut:K}=te(e),s=R(e,"search",""),c=R(e,"modelValue",[],l=>$(re(l)),l=>{const t=K(l);return e.multiple?t:t[0]??null}),m=ae(),{filteredItems:D,getMatches:z}=ee(e,x,k(()=>d.value?void 0:s.value)),h=k(()=>c.value.map(l=>x.value.find(t=>e.valueComparator(t.value,l.value))||l)),T=k(()=>e.hideSelected?D.value.filter(l=>!h.value.some(t=>t.value===l.value)):D.value),S=k(()=>h.value.map(l=>l.props.value)),b=V();function H(l){e.openOnClear&&(o.value=!0),s.value=""}function Q(){e.hideNoData&&!x.value.length||e.readonly||m!=null&&m.isReadonly.value||(o.value=!0)}function j(l){var t,v;e.readonly||m!=null&&m.isReadonly.value||(["Enter","ArrowDown","ArrowUp"].includes(l.key)&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(o.value=!0),["Escape"].includes(l.key)&&(o.value=!1),["Enter","Escape","Tab"].includes(l.key)&&(d.value=!0),l.key==="ArrowDown"?(t=b.value)==null||t.focus("next"):l.key==="ArrowUp"&&((v=b.value)==null||v.focus("prev")))}function q(l){s.value=l.target.value}function G(){f.value&&(d.value=!0)}function J(l){f.value=!0}function W(l){var t;l.relatedTarget==null&&((t=I.value)==null||t.focus())}const y=V(!1);function C(l){if(e.multiple){const t=S.value.findIndex(v=>e.valueComparator(v,l.value));if(t===-1)c.value=[...c.value,l],s.value="";else{const v=[...c.value];v.splice(t,1),c.value=v}}else c.value=[l],y.value=!0,a.selection||(s.value=l.title),o.value=!1,d.value=!0,U(()=>y.value=!1)}return N(f,l=>{var t;l?(y.value=!0,s.value=e.multiple||a.selection?"":String(((t=h.value.at(-1))==null?void 0:t.props.title)??""),d.value=!0,U(()=>y.value=!1)):(o.value=!1,s.value="")}),N(s,l=>{!f.value||y.value||(l&&(o.value=!0),d.value=!l)}),ie(()=>{const l=!!(e.chips||a.chip),t=!!(!e.hideNoData||T.value.length||a.prepend||a.append||a["no-data"]),[v]=fe(e);return n(me,A({ref:I},v,{modelValue:s.value,"onUpdate:modelValue":u=>{u==null&&(c.value=[])},validationValue:c.externalValue,dirty:c.value.length>0,onInput:q,class:["v-autocomplete",{"v-autocomplete--active-menu":o.value,"v-autocomplete--chips":!!e.chips,[`v-autocomplete--${e.multiple?"multiple":"single"}`]:!0,"v-autocomplete--selection-slot":!!a.selection}],appendInnerIcon:e.menuIcon,readonly:e.readonly,"onClick:clear":H,"onMousedown:control":Q,onFocus:()=>f.value=!0,onBlur:()=>f.value=!1,onKeydown:j}),{...a,default:()=>n(B,null,[n(pe,A({ref:M,modelValue:o.value,"onUpdate:modelValue":u=>o.value=u,activator:"parent",contentClass:"v-autocomplete__content",eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:G},e.menuProps),{default:()=>[t&&n(ne,{ref:b,selected:S.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:u=>u.preventDefault(),onFocusin:J,onFocusout:W},{default:()=>{var u,p,w;return[!T.value.length&&!e.hideNoData&&(((u=a["no-data"])==null?void 0:u.call(a))??n(L,{title:O(e.noDataText)},null)),(p=a["prepend-item"])==null?void 0:p.call(a),T.value.map((r,g)=>{var E;return((E=a.item)==null?void 0:E.call(a,{item:r,index:g,props:A(r.props,{onClick:()=>C(r)})}))??n(L,A({key:g},r.props,{onClick:()=>C(r)}),{prepend:F=>{let{isSelected:_}=F;return e.multiple&&!e.hideSelected?n(Ve,{modelValue:_,ripple:!1},null):void 0},title:()=>{var F,_;return d.value?r.title:ye(r.title,(F=z(r))==null?void 0:F.title,((_=s.value)==null?void 0:_.length)??0)}})}),(w=a["append-item"])==null?void 0:w.call(a)]}})]}),h.value.map((u,p)=>{function w(g){g.stopPropagation(),g.preventDefault(),C(u)}const r={"onClick:close":w,modelValue:!0,"onUpdate:modelValue":void 0};return n("div",{key:u.value,class:"v-autocomplete__selection"},[l?n(ce,{defaults:{VChip:{closable:e.closableChips,size:"small",text:u.title}}},{default:()=>[a.chip?a.chip({item:u,index:p,props:r}):n(he,r,null)]}):a.selection?a.selection({item:u,index:p}):n("span",{class:"v-autocomplete__selection-text"},[u.title,e.multiple&&p<h.value.length-1&&n("span",{class:"v-autocomplete__selection-comma"},[ve(",")])])])})])})}),Y({isFocused:f,isPristine:d,menu:o,search:s,filteredItems:D,select:C},I)}});export{Te as V};

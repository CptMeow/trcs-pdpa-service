import{m as ue}from"./VSelect-51189d3d.js";import{f as ne}from"./forwardRefs-8f7055de.js";import{m as oe,u as ie}from"./filter-00d6d293.js";import{m as se}from"./transition-482c18b0.js";import{u as re,t as I,V as ce,a as $}from"./VList-f23cbc26.js";import{b as ve}from"./VInput-354f6456.js";import{au as fe,aB as de,aQ as me,k as y,aE as K,B as h,ax as he,aH as be,z as P,ae as j,aA as pe,p as o,F as z,$ as R,a$ as ge,R as Ve}from"./main-51fa4cdd.js";import{m as xe,f as ye,V as ke}from"./VTextField-04866304.js";import{V as Ce}from"./VMenu-c40ddae7.js";import{V as we}from"./VCheckboxBtn-af15d0af.js";import{V as _e}from"./VChip-d98b0377.js";function Fe(l,m,_){if(m==null)return l;if(Array.isArray(m))throw new Error("Multiple matches is not implemented");return typeof m=="number"&&~m?o(z,null,[o("span",{class:"v-combobox__unmask"},[l.substr(0,m)]),o("span",{class:"v-combobox__mask"},[l.substr(m,_)]),o("span",{class:"v-combobox__unmask"},[l.substr(m+_)])]):l}const Be=fe()({name:"VCombobox",props:{delimiters:Array,...oe({filterKeys:["title"]}),...ue({hideNoData:!0,returnObject:!0}),...de(xe({modelValue:null}),["validationValue","dirty","appendInnerIcon"]),...se({transition:!1})},emits:{"update:modelValue":l=>!0,"update:search":l=>!0,"update:menu":l=>!0},setup(l,m){var O;let{emit:_,slots:u}=m;const{t:H}=me(),b=y(),p=y(!1),g=y(!0),N=y(),T=K(l,"menu"),c=h({get:()=>T.value,set:e=>{var a;T.value&&!e&&((a=N.value)!=null&&a.Î¨openChildren)||(T.value=e)}}),n=y(-1),Q=h(()=>{var e;return(e=b.value)==null?void 0:e.color}),{items:E,transformIn:q,transformOut:G}=re(l),{textColorClasses:J,textColorStyles:W}=he(Q),s=K(l,"modelValue",[],e=>q(be(e||[])),e=>{const a=G(e);return l.multiple?a:a[0]??null}),k=ve(),C=y(l.multiple?"":((O=s.value[0])==null?void 0:O.title)??""),i=h({get:()=>C.value,set:e=>{var a;if(C.value=e,l.multiple||(s.value=[I(l,e)]),e&&l.multiple&&((a=l.delimiters)!=null&&a.length)){const r=e.split(new RegExp(`(?:${l.delimiters.join("|")})+`));r.length>1&&(r.forEach(t=>{t=t.trim(),t&&x(I(l,t))}),C.value="")}e||(n.value=-1),p.value&&(c.value=!0),g.value=!e}});P(C,e=>{_("update:search",e)}),P(s,e=>{var a;l.multiple||(C.value=((a=e[0])==null?void 0:a.title)??"")});const{filteredItems:F,getMatches:X}=ie(l,E,h(()=>g.value?void 0:i.value)),V=h(()=>s.value.map(e=>E.value.find(a=>l.valueComparator(a.value,e.value))||e)),S=h(()=>l.hideSelected?F.value.filter(e=>!V.value.some(a=>a.value===e.value)):F.value),M=h(()=>V.value.map(e=>e.props.value)),B=h(()=>V.value[n.value]),L=y();function Y(e){l.openOnClear&&(c.value=!0)}function Z(){l.hideNoData&&!E.value.length||l.readonly||k!=null&&k.isReadonly.value||(c.value=!0)}function ee(e){var t,v;if(l.readonly||k!=null&&k.isReadonly.value)return;const a=b.value.selectionStart,r=M.value.length;if((n.value>-1||["Enter","ArrowDown","ArrowUp"].includes(e.key))&&e.preventDefault(),["Enter","ArrowDown"].includes(e.key)&&(c.value=!0),["Escape"].includes(e.key)&&(c.value=!1),["Enter","Escape","Tab"].includes(e.key)&&(g.value=!0),e.key==="ArrowDown"?(t=L.value)==null||t.focus("next"):e.key==="ArrowUp"&&((v=L.value)==null||v.focus("prev")),!!l.multiple){if(["Backspace","Delete"].includes(e.key)){if(n.value<0){e.key==="Backspace"&&!i.value&&(n.value=r-1);return}x(B.value),j(()=>!B.value&&(n.value=r-2))}if(e.key==="ArrowLeft"){if(n.value<0&&a>0)return;const d=n.value>-1?n.value-1:r-1;V.value[d]?n.value=d:(n.value=-1,b.value.setSelectionRange(i.value.length,i.value.length))}if(e.key==="ArrowRight"){if(n.value<0)return;const d=n.value+1;V.value[d]?n.value=d:(n.value=-1,b.value.setSelectionRange(0,0))}e.key==="Enter"&&i.value&&(x(I(l,i.value)),i.value="")}}function le(){p.value&&(g.value=!0)}function x(e){if(l.multiple){const a=M.value.findIndex(r=>l.valueComparator(r,e.value));if(a===-1)s.value=[...s.value,e];else{const r=[...s.value];r.splice(a,1),s.value=r}i.value=""}else s.value=[e],C.value=e.title,j(()=>{c.value=!1,g.value=!0})}function ae(e){p.value=!0}function te(e){var a;e.relatedTarget==null&&((a=b.value)==null||a.focus())}return P(F,e=>{!e.length&&l.hideNoData&&(c.value=!1)}),P(p,e=>{if(e)n.value=-1;else{if(c.value=!1,!l.multiple||!i.value)return;s.value=[...s.value,I(l,i.value)],i.value=""}}),pe(()=>{const e=!!(l.chips||u.chip),a=!!(!l.hideNoData||S.value.length||u.prepend||u.append||u["no-data"]),[r]=ye(l);return o(ke,R({ref:b},r,{modelValue:i.value,"onUpdate:modelValue":[t=>i.value=t,t=>{t==null&&(s.value=[])}],validationValue:s.externalValue,dirty:s.value.length>0,class:["v-combobox",{"v-combobox--active-menu":c.value,"v-combobox--chips":!!l.chips,"v-combobox--selecting-index":n.value>-1,[`v-combobox--${l.multiple?"multiple":"single"}`]:!0}],appendInnerIcon:l.items.length?l.menuIcon:void 0,readonly:l.readonly,"onClick:clear":Y,"onMousedown:control":Z,onFocus:()=>p.value=!0,onBlur:()=>p.value=!1,onKeydown:ee}),{...u,default:()=>o(z,null,[o(Ce,R({ref:N,modelValue:c.value,"onUpdate:modelValue":t=>c.value=t,activator:"parent",contentClass:"v-combobox__content",eager:l.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:l.transition,onAfterLeave:le},l.menuProps),{default:()=>[a&&o(ce,{ref:L,selected:M.value,selectStrategy:l.multiple?"independent":"single-independent",onMousedown:t=>t.preventDefault(),onFocusin:ae,onFocusout:te},{default:()=>{var t,v,d;return[!S.value.length&&!l.hideNoData&&(((t=u["no-data"])==null?void 0:t.call(u))??o($,{title:H(l.noDataText)},null)),(v=u["prepend-item"])==null?void 0:v.call(u),S.value.map((f,w)=>{var U;return((U=u.item)==null?void 0:U.call(u,{item:f,index:w,props:R(f.props,{onClick:()=>x(f)})}))??o($,R({key:w},f.props,{onClick:()=>x(f)}),{prepend:A=>{let{isSelected:D}=A;return l.multiple&&!l.hideSelected?o(we,{modelValue:D,ripple:!1},null):void 0},title:()=>{var A,D;return g.value?f.title:Fe(f.title,(A=X(f))==null?void 0:A.title,((D=i.value)==null?void 0:D.length)??0)}})}),(d=u["append-item"])==null?void 0:d.call(u)]}})]}),V.value.map((t,v)=>{function d(w){w.stopPropagation(),w.preventDefault(),x(t)}const f={"onClick:close":d,modelValue:!0,"onUpdate:modelValue":void 0};return o("div",{key:t.value,class:["v-combobox__selection",v===n.value&&["v-combobox__selection--selected",J.value]],style:v===n.value?W.value:{}},[e?o(ge,{defaults:{VChip:{closable:l.closableChips,size:"small",text:t.title}}},{default:()=>[u.chip?u.chip({item:t,index:v,props:f}):o(_e,f,null)]}):u.selection?u.selection({item:t,index:v}):o("span",{class:"v-combobox__selection-text"},[t.title,l.multiple&&v<V.value.length-1&&o("span",{class:"v-combobox__selection-comma"},[Ve(",")])])])})])})}),ne({isFocused:p,isPristine:g,menu:c,search:i,selectionIndex:n,filteredItems:F,select:x},b)}});export{Be as V};
